def _ffmpeg_dir(self):
    # Try imageio-ffmpeg inside the venv first
    code = "import os, imageio_ffmpeg; p=imageio_ffmpeg.get_ffmpeg_exe(); print(os.path.dirname(p))"
    try:
        out = subprocess.check_output([str(venv_python()), "-c", code], text=True).strip()
        exe_name = "ffmpeg.exe" if IS_WINDOWS else "ffmpeg"
        if out and Path(out, exe_name).exists():
            self.log("FFmpeg (imageio) at: " + out)
            return out
    except Exception as e:
        self.log("imageio-ffmpeg not available: " + str(e))

    # Fallback: system ffmpeg found on PATH
    exe_name = "ffmpeg.exe" if IS_WINDOWS else "ffmpeg"
    sys_ffmpeg = shutil.which(exe_name)
    if sys_ffmpeg:
        ff_dir = str(Path(sys_ffmpeg).parent)
        self.log("FFmpeg (system PATH) at: " + ff_dir)
        try:
            subprocess.check_call([sys_ffmpeg, "-version"], stdout=subprocess.DEVNULL, stderr=subprocess.DEVNULL)
            return ff_dir
        except Exception as e:
            self.log("FFmpeg on PATH failed -version check: " + str(e))

    # Not found
    return ""
